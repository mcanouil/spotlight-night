---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

# Spotlight Night Poster

<!-- badges: start -->
[![License](https://img.shields.io/github/license/mcanouil/spotlight-night)](LICENSE)
<!-- badges: end -->

```{r, include = FALSE}
source("assets/create_spotlight_night.R")

rscripts <- sort(
  x = list.files(path = "R", pattern = "^20.*\\.R$", full.names = TRUE),
  decreasing = TRUE
)

posters <- sub("\\.R$", "", basename(rscripts))
pngs <- sprintf("posters/%s.png", posters)

outdated <- !file.exists(posters) |
  (
    as.POSIXct(posters) < Sys.Date() &
    file.mtime(posters) < sapply(
      X = file.mtime(rscripts),
      FUN = function(x, y) max(c(x, y)),
      y = file.mtime("assets/create_spotlight_night.R")
    )
  )
message("Rendering posters ...")
invisible(lapply(rscripts[which(outdated)], source, encoding = "UTF-8"))
```

```{r, results = "asis", echo = FALSE}
cell <- sprintf(
  paste0(
    '<td align = "center">',
    '<img alt="Poster for %s Spotlight night" src="%s" width="100%%" height="auto" />',
    "</td>"
  ),
  posters, pngs
)

cols <- 4
rows <- ceiling(length(cell) / cols)

row_id <- rep(seq_len(rows), each = cols, length.out = length(cell))
row_cells <- split(cell, row_id)

cat('<table width="100%%">\n')
cat(paste0("<tr>", sapply(row_cells, paste, collapse = ""), "</tr>"), sep = "")
cat("</table>\n")
```
